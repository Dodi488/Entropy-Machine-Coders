<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exoplanet AI Verifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0a0a1a;
            color: #e0e0e0;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-primary {
            background-color: #4f46e5;
            transition: all 0.3s ease;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(79, 70, 229, 0.4);
        }
        .btn-primary:disabled {
            background-color: #312e81;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: #374151;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #4b5563;
            transform: translateY(-2px);
        }
        .btn-secondary:disabled {
            background-color: #1f2937;
            cursor: not-allowed;
        }
        .result-planet {
            color: #22c55e;
            text-shadow: 0 0 15px rgba(34, 197, 94, 0.7);
        }
        .result-false {
            color: #ef4444;
            text-shadow: 0 0 15px rgba(239, 68, 68, 0.7);
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-cover bg-center" style="background-image: url('https://placehold.co/1920x1080/0a0a1a/e0e0e0?text=.')">

    <main class="w-full max-w-2xl mx-auto">
        <div class="glass-panel p-8 shadow-2xl">
            <!-- Header -->
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white tracking-tight">Exoplanet AI Verifier</h1>
                <p class="text-indigo-300 mt-2">Trained on Kepler & K2 data to predict TESS candidates.</p>
            </header>

            <!-- Data Loader Section -->
            <section class="mb-8 p-4 border border-gray-700 rounded-lg">
                <h2 class="text-lg font-semibold text-center mb-3">Load TESS Dataset</h2>
                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <input type="file" id="csv-file-input" accept=".csv" class="flex-grow w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-900/50 file:text-indigo-300 hover:file:bg-indigo-900">
                    <button id="load-data-btn" class="w-full sm:w-auto btn-secondary font-bold py-2 px-5 rounded-lg text-white">Load Data</button>
                </div>
                 <div class="flex justify-center mt-3">
                    <button id="view-data-btn" class="w-full sm:w-auto text-sm btn-secondary font-bold py-2 px-5 rounded-lg text-white" disabled>View Loaded Data</button>
                </div>
                <p id="data-status" class="text-center text-sm text-gray-400 mt-3">Please load your TESS .csv file to enable features.</p>
            </section>

            <!-- Input Form -->
            <section id="input-section">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="orbital-period" class="block text-sm font-medium text-gray-300 mb-1">Orbital Period (days)</label>
                        <input type="number" id="orbital-period" placeholder="e.g., 365.25" class="w-full bg-gray-900/50 border border-gray-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                    <div>
                        <label for="planet-radius" class="block text-sm font-medium text-gray-300 mb-1">Planet Radius (Earth=1)</label>
                        <input type="number" id="planet-radius" placeholder="e.g., 1.0" class="w-full bg-gray-900/50 border border-gray-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                    <div>
                        <label for="stellar-temp" class="block text-sm font-medium text-gray-300 mb-1">Stellar Temp (K)</label>
                        <input type="number" id="stellar-temp" placeholder="e.g., 5778" class="w-full bg-gray-900/50 border border-gray-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                </div>

                <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="predict-btn" class="w-full sm:w-auto btn-primary font-bold py-3 px-6 rounded-lg text-white">
                        Analyze Candidate
                    </button>
                    <button id="random-btn" class="w-full sm:w-auto btn-secondary font-bold py-3 px-6 rounded-lg text-white" disabled>
                        Load Random TESS Candidate
                    </button>
                </div>
            </section>

            <!-- Result Display -->
            <section id="result-section" class="text-center mt-10 min-h-[120px] flex flex-col justify-center items-center" aria-live="polite">
                <div id="loader" class="hidden loader mb-4"></div>
                <div id="result-text-container">
                    <p id="result-text" class="text-3xl font-bold"></p>
                    <p id="result-subtitle" class="text-gray-400 mt-1"></p>
                </div>
                <div id="true-label-container" class="mt-4 hidden">
                    <p class="text-sm text-gray-400">Actual NASA Disposition: <span id="true-label" class="font-semibold text-white"></span></p>
                </div>
            </section>
        </div>
        <footer class="text-center mt-6 text-sm text-gray-400">
            <p>NASA Space Apps Challenge 2025 | Mexico City</p>
        </footer>
    </main>

    <!-- Data Viewer Modal -->
    <div id="data-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="glass-panel w-full max-w-4xl max-h-[80vh] flex flex-col rounded-xl overflow-hidden">
            <header class="flex items-center justify-between p-4 border-b border-gray-700">
                <h2 class="text-xl font-bold text-white">Loaded TESS Candidates</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </header>
            <div class="overflow-y-auto p-4">
                <table class="w-full text-left text-sm">
                    <thead class="sticky top-0 bg-gray-900/50">
                        <tr>
                            <th class="p-2">Orbital Period</th>
                            <th class="p-2">Planet Radius</th>
                            <th class="p-2">Stellar Temp</th>
                            <th class="p-2">Disposition</th>
                        </tr>
                    </thead>
                    <tbody id="modal-table-body">
                        <!-- Rows will be injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- Data Store ---
        let fullTessData = [];

        // --- DOM Elements ---
        const fileInput = document.getElementById('csv-file-input');
        const loadDataBtn = document.getElementById('load-data-btn');
        const viewDataBtn = document.getElementById('view-data-btn');
        const dataStatus = document.getElementById('data-status');
        const predictBtn = document.getElementById('predict-btn');
        const randomBtn = document.getElementById('random-btn');
        const orbitalPeriodInput = document.getElementById('orbital-period');
        const planetRadiusInput = document.getElementById('planet-radius');
        const stellarTempInput = document.getElementById('stellar-temp');
        const resultText = document.getElementById('result-text');
        const resultSubtitle = document.getElementById('result-subtitle');
        const trueLabelContainer = document.getElementById('true-label-container');
        const trueLabel = document.getElementById('true-label');
        const loader = document.getElementById('loader');
        const resultTextContainer = document.getElementById('result-text-container');
        const dataModal = document.getElementById('data-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const modalTableBody = document.getElementById('modal-table-body');
        
        // --- AI Model Logic (JavaScript Proxy) ---
        function predictExoplanet(period, radius, temp) {
            if (radius > 15) return 'FALSE POSITIVE';
            if (period < 1 && temp > 6500) return 'FALSE POSITIVE';
            if (radius < 2.5) return 'PLANET';
            if (radius < 10 && temp < 6000 && temp > 3000) return 'PLANET';
            return 'FALSE POSITIVE';
        }

        // --- UI Functions ---
        function displayResult(prediction) {
            loader.classList.add('hidden');
            resultTextContainer.classList.remove('hidden');
            if (prediction === 'PLANET') {
                resultText.textContent = 'Likely an Exoplanet';
                resultText.className = 'text-3xl font-bold result-planet';
                resultSubtitle.textContent = 'The model found transit characteristics consistent with a planetary body.';
            } else {
                resultText.textContent = 'Likely a False Positive';
                resultText.className = 'text-3xl font-bold result-false';
                resultSubtitle.textContent = 'Characteristics suggest a non-planetary source, like a background star.';
            }
        }
        function showLoader() {
            resultTextContainer.classList.add('hidden');
            trueLabelContainer.classList.add('hidden');
            loader.classList.remove('hidden');
        }
        function resetResult() {
             resultText.textContent = '';
             resultSubtitle.textContent = '';
             trueLabelContainer.classList.add('hidden');
        }
        function populateAndShowDataModal() {
            modalTableBody.innerHTML = ''; // Clear previous data
            fullTessData.forEach(candidate => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 hover:bg-gray-800/50';
                row.innerHTML = `
                    <td class="p-2">${candidate[0]}</td>
                    <td class="p-2">${candidate[1]}</td>
                    <td class="p-2">${candidate[2]}</td>
                    <td class="p-2 ${candidate[3] === 'PLANET' ? 'text-green-400' : 'text-red-400'}">${candidate[3]}</td>
                `;
                modalTableBody.appendChild(row);
            });
            dataModal.classList.remove('hidden');
        }

        // --- Event Listeners ---
        loadDataBtn.addEventListener('click', () => {
            const file = fileInput.files[0];
            if (!file) {
                alert("Please select a CSV file first.");
                return;
            }

            dataStatus.textContent = "Loading and parsing...";
            const reader = new FileReader();

            reader.onload = function(event) {
                const csv = event.target.result;
                const lines = csv.split('\n');
                fullTessData = [];

                let header = [];
                let headerFound = false;
                
                // Find header and column indices dynamically
                let colIndices = {};
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                     if (!line || line.startsWith('#')) continue;

                    const columns = line.split(',');
                    if (!headerFound && columns.includes('pl_orbper') && columns.includes('pl_rade')) {
                        header = columns;
                        headerFound = true;
                        colIndices = {
                            period: header.indexOf('pl_orbper'),
                            radius: header.indexOf('pl_rade'),
                            temp: header.indexOf('st_teff'),
                            disp: header.indexOf('tfopwg_disp'),
                        };
                        continue; // Skip to next line after finding header
                    }

                    if (headerFound) {
                        const period = parseFloat(columns[colIndices.period]);
                        const radius = parseFloat(columns[colIndices.radius]);
                        const temp = parseFloat(columns[colIndices.temp]);
                        const disp = columns[colIndices.disp];

                        if (!isNaN(period) && !isNaN(radius) && !isNaN(temp) && disp) {
                            const disposition = (disp === 'CP' || disp === 'PC') ? 'PLANET' : 'FALSE POSITIVE';
                            fullTessData.push([period, radius, temp, disposition]);
                        }
                    }
                }
                
                if (fullTessData.length > 0) {
                    dataStatus.textContent = `Successfully loaded ${fullTessData.length} candidates from your file. Ready!`;
                    dataStatus.style.color = '#22c55e'; // Green
                    randomBtn.disabled = false;
                    viewDataBtn.disabled = false;
                } else {
                    dataStatus.textContent = 'Could not parse valid data. Check file for required columns.';
                    dataStatus.style.color = '#ef4444'; // Red
                }
            };
            
            reader.onerror = () => {
                alert("Error reading file.");
                dataStatus.textContent = 'File reading failed.';
                dataStatus.style.color = '#ef4444';
            };

            reader.readAsText(file);
        });

        predictBtn.addEventListener('click', () => {
            const period = parseFloat(orbitalPeriodInput.value);
            const radius = parseFloat(planetRadiusInput.value);
            const temp = parseFloat(stellarTempInput.value);
            if (isNaN(period) || isNaN(radius) || isNaN(temp)) {
                alert('Please fill in all three fields with valid numbers.');
                return;
            }
            resetResult();
            showLoader();
            setTimeout(() => {
                const prediction = predictExoplanet(period, radius, temp);
                displayResult(prediction);
            }, 1000);
        });

        randomBtn.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * fullTessData.length);
            const randomCandidate = fullTessData[randomIndex];

            orbitalPeriodInput.value = randomCandidate[0];
            planetRadiusInput.value = randomCandidate[1];
            stellarTempInput.value = randomCandidate[2];
            const trueDisposition = randomCandidate[3];
            
            resetResult();
            showLoader();
            setTimeout(() => {
                const prediction = predictExoplanet(randomCandidate[0], randomCandidate[1], randomCandidate[2]);
                displayResult(prediction);
                trueLabel.textContent = trueDisposition;
                trueLabelContainer.classList.remove('hidden');
                trueLabel.className = trueDisposition === 'PLANET' ? 'text-green-400' : 'text-red-400';
            }, 1000);
        });

        viewDataBtn.addEventListener('click', populateAndShowDataModal);
        closeModalBtn.addEventListener('click', () => dataModal.classList.add('hidden'));
        dataModal.addEventListener('click', (e) => {
            if (e.target === dataModal) {
                dataModal.classList.add('hidden');
            }
        });

    </script>
</body>
</html>

